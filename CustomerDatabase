package src;


import java.io.File;
import java.io.FileWriter;
import java.io.PrintWriter;
import java.util.Scanner;

public class CustomerDatabase {

    public static Scanner input = new Scanner (System.in);
    public static LinkedList<Customer> customers = new LinkedList<Customer> ();
   

    public LinkedList<Customer> getCustomerDatabase( )
    {
        return customers;
    }


    public CustomerDatabase(String fileName)
    {
            try{
                File file = new File(fileName);
                Scanner read = new Scanner (file);
                String line = read.nextLine(); //Reads but never uses to get rid of the header.
                
                while(read.hasNext())
                {
                    line = read.nextLine();
                    String [] customerData = line.split(","); //Data is stored in CSV (Comma Separated File)
                    Customer customer = new Customer(Integer.parseInt(customerData[0]),customerData[1], customerData[2] );
                    customers.insert(customer);
                }
                read.close();
            }
            catch (Exception ex) {
                System.out.println(ex.getMessage());
            }
    }
  

    public void registerCustomer()
{
    	Customer customer = new Customer ();

    	System.out.println("Enter customer's ID: ");
    	customer.setCustomerID(input.nextInt());
    
    	while (checkCustomerID(customer.getCustomerID()))
    {
    		System.out.println("Customer with the entered ID already registered.\nKindly re-enter the ID.");
    		customer.setCustomerID(input.nextInt());
    }    
    
    	System.out.println("Enter the customer's name: ");
    	String name = input.nextLine();
    	name = input.nextLine();
    	customer.setName(name);
    
    	System.out.println("Enter customer's email: ");
    	customer.setEmail(input.nextLine());

    	customers.insert(customer);
    	writeToFile();
}
    


    public void orderHistory() {
        if (customers.empty()) {
            System.out.println("There is no order history.");
        }
        else {
            System.out.println("Enter customer's ID: ");
            int customerID = input.nextInt();
            
            boolean exists = false;
            
            customers.findFirst();
            for ( int i = 0 ; i < customers.size() ; i++ ) {
                if (customers.retrieve().getCustomerID() == customerID) {
                    exists = true;
                    break;
                }
                customers.findNext();
            }
            
            if (exists) {
                LinkedList<Integer> orderList = customers.retrieve().getOrders();
                if (orderList.empty())
                    System.out.println("No past orders for " + customers.retrieve().getCustomerID());
                else  {
                    System.out.println("Order History: ");
                    orderList.findFirst();
                    for (int j = 0 ; j < orderList.size() ; j++) {
                        System.out.println(orderList.retrieve());
                        orderList.findNext();
                    }
                 }
            }
            else
                System.out.println("Customer ID doesn't exist.");
        }
        
    }
    

    public boolean checkCustomerID(int customerID) {
        boolean exists = false;
        if (!customers.empty()){
            customers.findFirst();
            while (!customers.last()) {
                if (customers.retrieve().getCustomerID() == customerID)
                    exists = true; //Customer has been found.
                customers.findNext(); //Moves to the next customer.
            }
            if (customers.retrieve().getCustomerID() == customerID) //Last element.
                exists = true;
        }
        return exists ;
    }
        
    public Customer getCustomerID() {
        if (customers.empty()) {
            System.out.println("There is no customer data.");
        }
        else
        {
            System.out.println("Enter customer's ID: ");
            int customerID = input.nextInt();
            
            customers.findFirst();
            while (!customers.last()) {
                if (customers.retrieve().getCustomerID() == customerID)
                    return customers.retrieve();
                customers.findNext();
            }
            if (customers.retrieve().getCustomerID() == customerID) //Last element.
                return customers.retrieve();        
            
        }
        System.out.println("Customer ID doesn't exist."); //The loop is done, the id wasn't found.
        return null;
    }
    
    public void writeToFile() {
        try (PrintWriter pw = new PrintWriter(new FileWriter("customers.csv"))) {
            pw.println("CustomerID,Name,Email");
            customers.findFirst();
            for (int i = 0; i < customers.size(); i++) {
                Customer c = customers.retrieve();
                pw.println(c.getCustomerID() + "," + c.getName() + "," + c.getEmail());
                customers.findNext();
            }
        } catch (Exception e) {
            System.out.println("Error writing customers: " + e.getMessage());
        }
    }
    

}
